---
title: "R Notebook"
output: html_notebook
---
Libraries
```{r echo=FALSE}
library(tidyverse)
library(readr)
library(here)
library(styler)
```

Load Data
```{r echo=FALSE}
halloween_candies <- read_csv(here("clean_data/halloween_candy.csv"))
```

Total number of candy ratings given across the three years = 159348 and 126 candies were in the study. 
```{r echo=TRUE}
halloween_candies %>%
  group_by(candies_food) %>%
  summarise(n_candies_ratings = n()) %>%
  summarise(total_candies_ratings = sum(n_candies_ratings))

halloween_candies %>%
    group_by(candies_food) %>%
    summarise(n_candies = n_distinct(candies_food)) %>%
    summarise(total_candies_analysis = sum(n_candies))
```

Average age of people who are going out trick or treating themsel or not = 42 years  people that going out trick or treating themsel and 37 years that not going out trick or treating themsel.
```{r echo=TRUE}
halloween_candies %>%
  select(trick_themself, age) %>%
  filter(!is.na(trick_themself)) %>%
  group_by(trick_themself) %>%
  summarise(average_age = round(mean(age),0))
  
```

Candy bar revived the most of joy, despair and meh = Any full size candy bar Joy 790, Broken glow stick Despair 795, Lollipops Meh 490
```{r echo=TRUE}
max_votes <- halloween_candies %>%
  filter(!is.na(preference_candies)) %>%
  group_by(candies_food, preference_candies) %>%
  summarise(total_votes = n()) %>%
  group_by(preference_candies) %>%
  summarise(total_votes = max(total_votes)) 

halloween_candies %>%
  filter(!is.na(preference_candies)) %>%
  group_by(candies_food, preference_candies) %>%
  summarise(total_votes = n()) %>% 
  inner_join(max_votes)
  
```

People rated Starburst as despair = 355 persons
```{r echo=TRUE}
halloween_candies %>%
  filter(candies_food == "Starburst") %>%
  group_by(preference_candies) %>%
  summarise(total_starburst = n()) %>%
  filter(preference_candies == "DESPAIR")
```

Despair as -1, joy as +1 and meh as 0.
```{r echo=FALSE}
halloween_candies <- halloween_candies %>%
  mutate(puntuation = recode(preference_candies, 
                             DESPAIR = -1,
                             JOY = 1,
                             MEH = 0))
```

Most popular candy bar by this rating system for each gender in the dataset =
Any full sized candy bar for everyone. When I take this out the result is: 
KitKat and Lindt Truffle for Women
KitKat for Male
Twix for other
KitKat for people that prefer don't say the gender
```{r echo=TRUE}
halloween_candies %>%
  filter(!c(gender == "Not ask" | is.na(preference_candies))) %>%
  group_by(gender, candies_food) %>%
  summarise(total_prefence = sum(puntuation)) %>%
  filter(candies_food != "Any full-sized candy bar") %>%
  top_n(1)

```

Most popular candy bar by this rating system for each year in the dataset =
It is Any full-sized candy bar, in each year. If I take out Any full-sized candy bar, the result is =
Kit kat is the favorite every year
```{r}
halloween_candies %>%
  filter(!is.na(preference_candies)) %>%
  group_by(year, candies_food) %>%
  summarise(total_prefence = sum(puntuation)) %>%
  filter(candies_food != "Any full-sized candy bar") %>%
  arrange(desc(total_prefence))
  top_n(1)

```

Most popular candy bar by this rating system for each country in the dataset =

```{r}
halloween_candies %>%
  filter(!c(year == 2015 | is.na(preference_candies))) %>%
  group_by(country, candies_food)  %>%
  summarise(total_prefence = sum(puntuation)) %>%
  filter(candies_food != "Any full-sized candy bar") %>%
  arrange(desc(total_prefence)) %>%
  top_n(1)
```

